---
title: "Analysis of NBA Player Statistics and Salary for 2021-2022 Season"
author: "Spencer Friedman and Jon Abraham"
date: "05/25/2023"
output:
  pdf_document: default
  html_document:
    df_print: paged
editor_options: 
  chunk_output_type: console
---

```{r, echo=FALSE, message = FALSE, results = FALSE, warning=FALSE}
# library load statements here- remember, no install statements.
# some useful libraries you may find useful:
library(knitr) # for rendering tables with the kable function.
library(dplyr)
library(ggplot2)
library(rvest)
library(dplyr)
library(readxl)
library(tree)
library(rpart)
library(gbm)
library(randomForest)
```

## 1. Project Overview. 

Main purpose of the report and guiding questions you will investigate. Include any specific information about the domain and what you plan to study about that domain that the audience should know to understand the rest of your report.

The main purpose of our project is to understand why NBA players are paid as much as they are. Some players make closer to normal salaries, while others make many millions a year, and we
hope to understand why it is that certain players make more money than others.
A team is going to pay a player based on the success that they predict the player to bring to the team. In other words, a team hopes a player performs well in the statistical area that
is specific to their position. For example, a point guard is considered the play maker of the team and therefore is expected to have a lot of assists. 
We are still interested in understanding what combinations of statistics are most
associated with high salaries. We think that viewing this data position specific will provide
more clarification on what statistics are most important based on that position and what statistics determine if they are a good player in that position.

## 2. Data and Resources Used.

Describe where you obtained data from, what variables you used, their data types and distributions. Clearly describe what the variables measure.


The data that we used was retrieved from two sources. Both data sources needed to be web-scraped from their respective websites using the xpath because the sites did not provide a good method for downloading the data. The salary data was retrieved from https://hoopshype.com/salaries/players/2021-2022/, and the player performance data was retrieved from https://www.basketball-reference.com/leagues/NBA_2022_totals.html. After that, both of the data sources needed to be cleaned before we combined them into our final data product. We had to make a few significant data cleaning measures listed below: 

- For salary, we had to remove the commas and '$' from the salary column
- For the player statistics, we had to remove duplicates of player instances for players who played on multiple teams in one season
- Additionally, for the player statistics, we had to change the variable names of all the variables with numbers or '%' in the name because R is unable to handle them as variable names.
- We also had to convert most of the variables in statistics from character to numeric
- Lastly, we dropped any players that had a double position listed because it would mess up our position-specific analysis. 

In its final form, the data contains some of the the following variables: 
Salary (Salary): This variable measures the NBA player's salary for the 2021-2022 season
: Data Type: numeric
: Range/Levels: 13294-45780966

Rank (RK): This variable measures the player's rank in the season. 
: Data Type: numeric
: Range/Levels: 1-605

Position (POS): This variable indicates a player's position during the season.  
: Data Type: categorical
: Range/Levels: C, C-PF, PF, PF-SF, PG, PG-SG, SF, SF-SG, SG,SG-PG, SG-SF

Games (G): This variable measures the number of games the player played in. 
: Data Type: numeric
: Range/Levels: 1-82

Games Started (GS): This variable measures the number of games the player started in 
: Data Type: numeric
: Range/Levels: 0-82

Minutes Played (MP): This variable measures the number of minutes a player played
: Data Type: numeric
: Range/Levels: 1-2854

Field Goals (FG): This variable measures the number of field goals that a player made
: Data Type: numeric
: Range/Levels: 0-774

Effective Field Goal Percentage (eFPPerc): This variable measures the field goal percentage of a player, but takes into account that 3 pointers count more than 2 pointers. 
: Data Type: numeric
: Range/Levels: 1-2854

The data ultimately has 530 player entries and each player has 29 attributes. 

```{r Reading in the Data}
url_salary <- 'https://hoopshype.com/salaries/players/2021-2022/'
x_path <- '//*[@id="content-container"]/div/div[3]/div[2]/table'
salary_table <- url_salary %>%
  read_html() %>%
  html_element(xpath = x_path) %>%
  html_table()

url_stats <- 'https://www.basketball-reference.com/leagues/NBA_2022_totals.html'
x_path_stats <- '//*[@id="totals_stats"]'
df.stats <- url_stats %>%
  read_html() %>%
  html_element(xpath = x_path_stats) %>%
  html_table()
```

```{r Cleaning the dataframes}
# For Salary
colnames(salary_table) <- as.character(salary_table[1,])
salary_table <- salary_table[-1,]
salary_table <- subset(salary_table, select  = -ncol(salary_table))
salary_table <- subset(salary_table, select = -which(names(salary_table) == "NA"))
salary_table$`2021/22`<- gsub("\\$", "", salary_table$`2021/22`)
salary_table$`2021/22`<- gsub(",", "", salary_table$`2021/22`)
names(salary_table)[names(salary_table) == "2021/22"] <- "salary"
salary_table$salary <- as.numeric(salary_table$salary)
                                
# For Player Stats
age <- select(df.stats, Age) 
df.stats <- select(df.stats, -Age)
tm <- select(df.stats, Tm) 
df.stats <- select(df.stats, -Tm)
df.stats$Pos <- factor(df.stats$Pos)
df.stats.distinct <- df.stats %>% 
  distinct(Player, .keep_all = TRUE)
colnames(df.stats.distinct)[colnames(df.stats.distinct) == "FG%"] <- "FGPerc"
colnames(df.stats.distinct)[colnames(df.stats.distinct) == "3P%"] <- "ThreePPerc"
colnames(df.stats.distinct)[colnames(df.stats.distinct) == "2P%"] <- "TwoPPerc"
colnames(df.stats.distinct)[colnames(df.stats.distinct) == "eFG%"] <- "eFGPerc"
colnames(df.stats.distinct)[colnames(df.stats.distinct) == "FT%"] <- "FTPerc"
colnames(df.stats.distinct)[colnames(df.stats.distinct) == "3P"] <- "ThreePointers"
colnames(df.stats.distinct)[colnames(df.stats.distinct) == "2P"] <- "TwoPointers"
colnames(df.stats.distinct)[colnames(df.stats.distinct) == "3PA"] <- "ThreePointAvg"
colnames(df.stats.distinct)[colnames(df.stats.distinct) == "2PA"] <- "TwoPointAvg"
```

```{r Merging the Data}
merged.player.data <- merge(salary_table, df.stats.distinct, by = "Player", all = FALSE)
```

```{r}
merged.player.data$Rk <- as.numeric(merged.player.data$Rk)
merged.player.data$G <- as.numeric(merged.player.data$G)
merged.player.data$GS <- as.numeric(merged.player.data$GS)
merged.player.data$MP <- as.numeric(merged.player.data$MP)
merged.player.data$FG <- as.numeric(merged.player.data$FG)
merged.player.data$FGA <- as.numeric(merged.player.data$FGA)
merged.player.data$FGPerc <- as.numeric(merged.player.data$FGPerc)
merged.player.data$ThreePointers <- as.numeric(merged.player.data$ThreePointers)
merged.player.data$ThreePointAvg <- as.numeric(merged.player.data$ThreePointAvg)
merged.player.data$ThreePPerc <- as.numeric(merged.player.data$ThreePPerc)
merged.player.data$TwoPointers <- as.numeric(merged.player.data$TwoPointers)
merged.player.data$TwoPointAvg <- as.numeric(merged.player.data$TwoPointAvg)
merged.player.data$TwoPPerc <- as.numeric(merged.player.data$TwoPPerc)
merged.player.data$eFGPerc <- as.numeric(merged.player.data$eFGPerc)
merged.player.data$FT <- as.numeric(merged.player.data$FT)
merged.player.data$FTA <- as.numeric(merged.player.data$FTA)
merged.player.data$FTPerc <- as.numeric(merged.player.data$FTPerc)
merged.player.data$ORB <- as.numeric(merged.player.data$ORB)
merged.player.data$DRB <- as.numeric(merged.player.data$DRB)
merged.player.data$TRB <- as.numeric(merged.player.data$TRB)
merged.player.data$AST <- as.numeric(merged.player.data$AST)
merged.player.data$STL <- as.numeric(merged.player.data$STL)
merged.player.data$BLK <- as.numeric(merged.player.data$BLK)
merged.player.data$TOV <- as.numeric(merged.player.data$TOV)
merged.player.data$PF <- as.numeric(merged.player.data$PF)
merged.player.data$PTS <- as.numeric(merged.player.data$PTS)
```
```{r}
merged.player.data <- merged.player.data[merged.player.data$Pos != 'PF-SF' & merged.player.data$Pos != 'PF-SG' & merged.player.data$Pos != 'SF-SG' & merged.player.data$Pos != 'SG-PG' & merged.player.data$Pos != 'SG-SF' & merged.player.data$Pos != 'PG-SG', ]
```

### Exploratory Data Analysis
Include plots and tables to show the ranges and distributions of the important variables- you donâ€™t necessarily have to do this for all variables, just the important ones. Do not display a raw summary of the entire dataset (data dump). Mention any modifications to the data (cleaning). Links to data sources go in the References section at the end of the doc.

Taking a look at the most important variable, salary, we noticed that the data is very skewed, as seen in the histogram below. Because of that, we decided to create a variable that represented the log of salary to create a more normally distributed variable for the model.
```{r Salary}
hist(merged.player.data$salary)
```
```{r Taking the log of salary}
merged.player.data$log_salary <- log(merged.player.data$salary)
hist(merged.player.data$log_salary)
```

We also wanted to better understand how a player's salary was related to the way they perform, in other words what statistics they peform well in based on their position. 
```{r Bubble Plot of Points to Assists Based on Position}
ggplot(merged.player.data, aes(x=PTS, y=AST, size = salary, color = Pos)) +
    geom_point(alpha=0.8)
```

```{r}
ggplot(merged.player.data, aes(x=ThreePointers, y=TwoPointers, size = salary, color = Pos)) +
    geom_point(alpha=0.8)
```
```{r salary}
plot(merged.player.data$Rk, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$Rk))

plot(merged.player.data$G, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$G))

plot(merged.player.data$GS, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$GS))

plot(merged.player.data$MP, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$MP))

plot(merged.player.data$FG, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$FG))

plot(merged.player.data$FGA, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$FGA))

plot(merged.player.data$FGPerc, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$FGPerc))

plot(merged.player.data$ThreePointers, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$ThreePointers))

plot(merged.player.data$ThreePointAvg, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$ThreePointAvg))

plot(merged.player.data$ThreePPerc, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$ThreePPerc))

plot(merged.player.data$TwoPointers, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$TwoPointers))

plot(merged.player.data$TwoPointAvg, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$TwoPointAvg))

plot(merged.player.data$TwoPPerc, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$TwoPPerc))

plot(merged.player.data$eFGPerc, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$eFGPerc))

plot(merged.player.data$FT, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$FT))

plot(merged.player.data$FTA, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$FTA))

plot(merged.player.data$FTPerc, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$FTPerc))

plot(merged.player.data$ORB, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$ORB))

plot(merged.player.data$DRB, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$DRB))

plot(merged.player.data$TRB, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$TRB))

plot(merged.player.data$AST, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$AST))

plot(merged.player.data$STL, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$STL))

plot(merged.player.data$BLK, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$BLK))

plot(merged.player.data$TOV, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$TOV))

plot(merged.player.data$PF, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$PF))

plot(merged.player.data$PTS, merged.player.data$salary)
abline(lm(merged.player.data$salary ~ merged.player.data$PTS))



hist(merged.player.data$Rk)
hist(merged.player.data$G)
hist(merged.player.data$GS)
hist(merged.player.data$MP)
hist(merged.player.data$FG)
hist(merged.player.data$FGA)
hist(merged.player.data$FGPerc)
hist(merged.player.data$ThreePointers)
hist(merged.player.data$ThreePointAvg)
hist(merged.player.data$ThreePPerc)
hist(merged.player.data$TwoPointers)
hist(merged.player.data$TwoPointAvg)
hist(merged.player.data$TwoPPerc)
hist(merged.player.data$eFGPerc)
hist(merged.player.data$FT)
hist(merged.player.data$FTA)
hist(merged.player.data$FTPerc)
hist(merged.player.data$ORB)
hist(merged.player.data$DRB)
hist(merged.player.data$TRB)
hist(merged.player.data$AST)
hist(merged.player.data$STL)
hist(merged.player.data$BLK)
hist(merged.player.data$TOV)
hist(merged.player.data$PF)
hist(merged.player.data$PTS)

```
## 3. Analysis.

This is where you explain the methods you used to carry out the analysis to investigate the guiding question(s). State what techniques you used, what variables were included. Identify the independent and dependent variables. Did you preprocess the data? Include the results of any modeling and explain what they mean.

Code Chunks

Examples of using R markdown and code chunks. See the links in the references section for more on using code chunk options to control rendering.

Example of a code chunk that hides the code from being rendered:

```{r echo=FALSE}

```

Create an example table and use kable to render it nicely:

```{r echo=FALSE}

```

Notice the table is automatically numbered.

Rendering a barplot using the caption option:

```{r echo=FALSE, out.width="75%", out.height="75%", fig.cap = "Bar Plot Example base R", fig.align = 'center'}

counts <- table(mtcars$vs, mtcars$gear)
my.plot<-barplot(counts, main="Car Distribution by Gears and VS",
  xlab="Number of Gears", col=c("gray","gray43"),
  ylim = c(0, max(counts) + 1),
  legend = rownames(counts), beside=TRUE)
text(x = my.plot, y = counts + 0.5, counts, cex = 0.8, col = "red")

```

Adding another plot:

```{r echo=FALSE, out.width="75%", out.height="75%", fig.align = 'center', fig.cap = "Bar Plot Example ggplot2"}
ggplot(mtcars, aes(x = factor(cyl))) +
  geom_bar() +
  geom_text(aes(label = after_stat(count)), vjust=-1, stat = "count") +
  xlab('cylinders') 
```

Notice the plots are automatically numbered.

Adding a page break:

\newpage

## Summary and Conclusions.

In this section, you briefly summarize what you did and state the conclusions that you have determined based on the results of what you did in the analysis part above. This should be a single paragraph. It is important to clearly state what you conclude about your results. Point out any possible problems that you that may have an effect on your conclusions. For example, small data size, lot of missing values, suspected 

## References

This part is a list of links to the data set(s) you used. Also include links to any resources you used in your project, such as code examples that you adapted to your project or tutorials on analysis techniques that were an important part of your project. You do not have to list any resources from our course material or from R documentation.

* https://rmarkdown.rstudio.com/lesson-3.html 
* https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf






















